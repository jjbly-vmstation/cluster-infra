## Keycloak Helm values for the codecentric/keycloak chart.
## IMPORTANT:
## - This chart's values are NOT nested under "keycloak:" (chart v9+).
## - "extraEnv" and "extraEnvFrom" are templated using Helm's "tpl" and must be strings.

replicas: 1

# We run a separate PostgreSQL (deployed by identity-postgresql), so disable the subchart.
postgresql:
  enabled: false

# Provide DB connection info to Keycloak.
extraEnv: |
  - name: DB_VENDOR
    value: postgres
  - name: DB_ADDR
    value: "keycloak-postgresql"
  - name: DB_PORT
    value: "5432"
  - name: DB_DATABASE
    value: "keycloak"
  - name: DB_USER
    value: "keycloak"
  - name: DB_PASSWORD
    valueFrom:
      secretKeyRef:
        name: keycloak-postgresql
        key: postgresql-password

# Create the initial admin user via KEYCLOAK_USER / KEYCLOAK_PASSWORD.
# The Secret name will be: <release fullname>-admin (normally "keycloak-admin").
secrets:
  admin:
    stringData: {}

extraEnvFrom: |
  - secretRef:
      name: '{{ include "keycloak.fullname" . }}-admin'

# Schedule Keycloak pods on the control-plane (masternode) by default and
# add tolerations so they can run on tainted control-plane nodes. You can
# override these in Helm --set flags if needed.
nodeSelector:
  kubernetes.io/hostname: masternode

tolerations:
  - key: "node-role.kubernetes.io/control-plane"
    operator: "Exists"
    effect: "NoSchedule"
  - key: "node-role.kubernetes.io/master"
    operator: "Exists"
    effect: "NoSchedule"
