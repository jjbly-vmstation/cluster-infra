# Example Keycloak Helm values file for quick install.
# Copy to keycloak-values.yaml and replace placeholders before running the playbook.
# NOTE: This is a minimal example for non-production testing. For production, use
# a proper external database, persistent storage, and secret management.
#
# STORAGE CONFIGURATION:
# The identity-deploy-and-handover.yml playbook creates:
# - A 'manual' StorageClass for manual PV provisioning
# - A PersistentVolume (keycloak-postgresql-pv) at /srv/identity_data/postgresql
# This resolves the "PVC data-keycloak-postgresql-0 Pending" issue by providing
# storage for the PostgreSQL database used by Keycloak.

replicaCount: 1

# Admin credentials (replace before installing)
keycloak:
  adminUser: "admin"
  adminPassword: "CHANGEME_ADMIN_PASSWORD"

# Service exposure
service:
  type: ClusterIP
  port: 8080

# Use internal DB (not recommended for production)
# For development/testing with h2, set vendor: h2 and disable postgresql
# For production, use postgresql with persistent storage
database:
  vendor: postgres
  # For production, configure externalPostgres with host/port/database/user/password

# PostgreSQL subchart configuration (when using internal PostgreSQL)
postgresql:
  enabled: true
  auth:
    username: keycloak
    password: "CHANGEME_DB_PASSWORD"
    database: keycloak
  primary:
    persistence:
      enabled: true
      storageClass: "manual"  # Use the manual StorageClass created by the playbook
      size: 10Gi
  # Image overrides: if Docker Hub pull fails (rate limiting, missing tag, or proxy),
  # you can override the image repository/tag here or configure image pull secrets.
  # Examples:
  # image:
  #   registry: docker.io
  #   repository: bitnami/postgresql
  #   tag: 11.14.0-debian-10-r28
  #   pullPolicy: IfNotPresent
  # imagePullSecrets:
  #   - name: regcred
  #
  # If you need to authenticate to Docker Hub (or another registry), create
  # a docker-registry secret and set its name under `imagePullSecrets`:
  # kubectl create secret docker-registry regcred \
  #   --docker-server=https://index.docker.io/v1/ \
  #   --docker-username=<user> --docker-password=<pass> --docker-email=<email> -n identity

# Persistence for Keycloak itself (themes, providers, etc)
persistence:
  enabled: false
  size: 10Gi

# Ingress (optional) - configure your ingress controller and host
ingress:
  enabled: false
  annotations: {}
  hosts:
    - host: keycloak.vmstation.local
      paths:
        - /
  tls: []

# FreeIPA / LDAP federation placeholders - configure after Keycloak is up
# Example values for the Keycloak LDAP federation provider - this file does NOT
# configure federation automatically; use Keycloak UI or API to add LDAP provider.
freeipa:
  ldapUrl: "ldap://masternode.vmstation.local"
  bindDn: "uid=admin,cn=users,cn=accounts,dc=vmstation,dc=local"
  bindCredential: "CHANGEME_LDAP_BIND_PASSWORD"
  usersDn: "cn=users,cn=accounts,dc=vmstation,dc=local"
  searchScope: 1

# Additional flags
proxyAddressForwarding: true

# Resource requests/limits (tune for your environment)
resources:
  requests:
    cpu: "100m"
    memory: "256Mi"
  limits:
    cpu: "500m"
    memory: "1Gi"
