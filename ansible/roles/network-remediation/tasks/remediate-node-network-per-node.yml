---
# Per-node remediation tasks included by `remediate-node-network.yml`.
# Expects `node_target` loop var to be set by the caller.

- name: "Start remediation on node {{ node_target }}"
  debug:
    msg: "Running remediation on {{ node_target }}"

# Run sysctls and modules remediation on target node
- name: Ensure sysctls and kernel modules on node
  delegate_to: "{{ node_target }}"
  include_tasks: ensure-sysctls-and-modules.yml

# Run iptables remediation on target node
- name: Check and fix iptables configuration on node
  delegate_to: "{{ node_target }}"
  include_tasks: iptables-remediation.yml

# Run IPVS remediation on target node if enabled
- name: Check and clear IPVS state on node if needed
  delegate_to: "{{ node_target }}"
  include_tasks: ipvs-remediation.yml
  when: ipvs_cleanup_enabled | bool

- name: "Remediation completed on node {{ node_target }}"
  debug:
    msg: "âœ“ Remediation completed on {{ node_target }}"
